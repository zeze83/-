---
title: "Statistical Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: flatly
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ggplot2)
library(reshape2)
```


## Statistical Analysis

To investigate the relationship between the variables (...) and diabetes status, we conducted (...) statistical tests and build a predictive model. 

First, we read in the dataset. 

```{r read data01}
diabetes_data01 <- read_csv("data/Diabetes_012_data.csv")

diabetes_data01 <- 
  diabetes_data01 |>
  select(Diabetes_012,HighBP,HighChol, BMI, Smoker, 
         HeartDiseaseorAttack, Sex,Income, Education, 
         PhysActivity, Fruits, Veggies, Age, HvyAlcoholConsump)

diabetes_data01
```


#### Correlation analysis for Continuous Variables
```{r correlation}
correlationX <- 
  diabetes_data01 |>
  select(-starts_with("Diabetes_012"))

correlations <- cor(correlationX,diabetes_data01$Diabetes_012)
cor_df <- data.frame(Variable = names(correlationX), Correlation = correlations)
ggplot(cor_df, aes(x = Variable, y = Correlation)) +
  geom_bar(stat = "identity", fill = "purple") +
  theme_minimal() +
  labs(title = "Correlation with Diabetes_012", x = "Variable", y = "Correlation") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


#### Chi-Square for Independence for Categorical Variables

```{r read data}
diabetes_data <- read_csv("data/diabetes_new1.csv") 
numeric_cols <- sapply(diabetes_data, is.numeric)
diabetes_data[numeric_cols] <- lapply(diabetes_data[numeric_cols], as.numeric)

head(diabetes_data)

diabetes_data <- diabetes_data |>
     mutate(Diabetes_binary = factor(Diabetes_status, levels = c("No Diabetes", "Diabetes"), labels = c(0, 1)))



cor(diabetes_data$BMI, as.numeric(diabetes_data$Diabetes_binary), method = "pearson") 
cor(diabetes_data$Age, as.numeric(diabetes_data$Diabetes_binary), method = "pearson") 

```
```

```{r}


chisq_test_HighBP <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$HighBP))
chisq_test_HighBP


chisq_test_HighChol <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$HighChol))
chisq_test_HighChol

chisq_test_HeartDiseaseorAttack <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$HeartDiseaseorAttack))
chisq_test_HeartDiseaseorAttack

chisq_test_Smoker <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Smoker))
chisq_test_Smoker

chisq_test_Sex <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Sex))
chisq_test_Sex

chisq_test_Income <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Income))
chisq_test_Income

chisq_test_Education <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Education))
chisq_test_Education

chisq_test_PhysActivity <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$PhysActivity))
chisq_test_PhysActivity

chisq_test_Fruits <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Fruits))
chisq_test_Fruits

chisq_test_Veggies <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$Veggies))
chisq_test_Veggies

chisq_test_HvyAlcoholConsump <- chisq.test(table(diabetes_data$Diabetes_status, diabetes_data$HvyAlcoholConsump))
chisq_test_HvyAlcoholConsump
```
```{r}
# Install the 'infotheo' package if you haven't already
# install.packages("infotheo")

# Load the necessary library
library(infotheo)

# Assume X is your feature matrix and Y is the target variable
# Replace these with your actual data
```


```{r}
#X <- diabetes_data01 |>
#  select(-Diabetes_012)
#Y <- diabetes_data01$Diabetes_012

# Function to calculate mutual information between each feature and the target variable
#mutual_info <- function(feature, target) {
#  infotheo::info_gain(feature, target)
#}

# Apply the mutual_info function to each feature in X
#feature_scores <- sapply(X, mutual_info, target = Y)

# Create a data frame with feature names and their scores
#f_Scores <- data.frame(Feature = names(feature_scores), Score = feature_scores)

# Sort the data frame by scores in descending order
#f_Scores <- f_Scores[order(-f_Scores$Score), ]

# Select the top 10 features
#top_10_features <- f_Scores[1:10, ]

# Print the result
#print(top_10_features)

```


#### Modeling with Logistic Regression

```{r}
model <- glm(Diabetes_binary ~ HighBP + HighChol + BMI + Smoker + HeartDiseaseorAttack + Sex + Income + Education + PhysActivity + Fruits + Veggies + Age + HvyAlcoholConsump, family = "binomial", data = diabetes_data)
summary(model)

```