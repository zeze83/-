---
title: "Statistical Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: flatly
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ggplot2)
library(reshape2)
library(infotheo)
```


## Statistical Analysis

To investigate the relationship between the variables High Blood Pressure, High Cholesterol Level, BMI, Sex, Fruits Consumption, Veggies Consumption, Smoking, Income Level, Physical Acitivity, and diabetes status, we conducted correlation and ANOVA statistical tests and build a predictive model. 

First, we read in the dataset. 

```{r read data01}
diabetes_data01 <- read_csv("data/Diabetes_012_data.csv")

diabetes_data01 <- 
  diabetes_data01 |>
  select(Diabetes_012,HighBP,HighChol, BMI, Smoker, 
         Income, Sex,
         PhysActivity, Fruits, Veggies)|>
         filter(Diabetes_012 == '2' | Diabetes_012 == '0') |>
  mutate(Diabetes_012=ifelse(Diabetes_012=="2","1",Diabetes_012))|>
  mutate(Diabetes_012=as.numeric(Diabetes_012))

diabetes_data01
```


#### Correlation analysis for Continuous Variables
```{r correlation}
correlationX <- 
  diabetes_data01 |>
  select(-starts_with("Diabetes_012"))

correlations <- cor(correlationX,diabetes_data01$Diabetes_012)
cor_df <- data.frame(Variable = names(correlationX), Correlation = correlations)
ggplot(cor_df, aes(x = Variable, y = Correlation)) +
  geom_bar(stat = "identity", fill = "purple") +
  theme_minimal() +
  labs(title = "Correlation with Diabetes_012", x = "Variable", y = "Correlation") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

#### ANOVA
```{r}
dependent_var <- diabetes_data01[[1]]
independent_vars <- diabetes_data01[,-1]
independent_vars <- data.frame(lapply(independent_vars, function(x) as.factor(x)))
lm_model <- lm(dependent_var ~ ., data = independent_vars)

# Perform ANOVA
anova_results <- anova(lm_model)

# Display the ANOVA results
print(anova_results)
```
#### Chi-Square all together
```{r}
chi_square_results <- data.frame(Variable = character(), ChiSquare = numeric(), PValue = numeric(), stringsAsFactors = FALSE)

# Perform chi-square test for each independent variable
for (var in names(independent_vars)) {
  # Create a contingency table
  table <- table(dependent_var, independent_vars[[var]])
  
  # Perform chi-square test
  test <- chisq.test(table)
  
  # Store the results
  chi_square_results <- rbind(chi_square_results, data.frame(Variable = var, ChiSquare = test$statistic, PValue = test$p.value))
}

# Order results by p-value
chi_square_results <- chi_square_results %>%
  arrange(PValue)

# Print the results
print(chi_square_results)
```



```{r}
#X <- diabetes_data01 |>
#  select(-Diabetes_012)
#Y <- diabetes_data01$Diabetes_012

# Function to calculate mutual information between each feature and the target variable
#mutual_info <- function(feature, target) {
#  infotheo::info_gain(feature, target)
#}

# Apply the mutual_info function to each feature in X
#feature_scores <- sapply(X, mutual_info, target = Y)

# Create a data frame with feature names and their scores
#f_Scores <- data.frame(Feature = names(feature_scores), Score = feature_scores)

# Sort the data frame by scores in descending order
#f_Scores <- f_Scores[order(-f_Scores$Score), ]

# Select the top 10 features
#top_10_features <- f_Scores[1:10, ]

# Print the result
#print(top_10_features)

```

